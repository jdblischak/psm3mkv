<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Mortality adjustments • psm3mkv</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><link href="../extra.css" rel="stylesheet">
<meta property="og:title" content="Mortality adjustments">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">psm3mkv</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.3.2</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/example.html">Example use of psm3mkv</a></li>
    <li><a class="dropdown-item" href="../articles/mortality-adjustments.html">Mortality adjustments</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/Merck/psm3mkv/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Mortality adjustments</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/Merck/psm3mkv/blob/main/vignettes/mortality-adjustments.Rmd" class="external-link"><code>vignettes/mortality-adjustments.Rmd</code></a></small>
      <div class="d-none name"><code>mortality-adjustments.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>This is the second in a series of vignettes illustrating methods for
evaluating the fit and efficiency of three state oncology
cost-effectiveness model structures, as described in an accompanying
journal article <span class="citation">(Muston 2024)</span>. The package
is heavily dependent on flexsurv <span class="citation">(Jackson
2016)</span>.</p>
<p>After fitting models, as described in
<code><a href="../articles/example.html">vignette("example")</a></code>, estimates of Restricted Mean Durations
(RMDs) in health states can be calculated after constraining for
background mortality from a given life table.</p>
<div class="section level3">
<h3 id="notation">Notation<a class="anchor" aria-label="anchor" href="#notation"></a>
</h3>
<p>We denote functions of survival, hazard and cumulative hazard as
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>S</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>t</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>,</mo><mi>h</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>t</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">S(t), h(t)</annotation></semantics></math>
and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>H</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>t</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">H(t)</annotation></semantics></math>.
There are ‘unadjusted’ values for relevant endpoints (e.g. PFS)
dependent on the model structure (PSM, STM-CF or STM-CR). We assume that
there is a ‘general background mortality’, against which any
extrapolations and derivations of RMD should be constrained, denoted
with subscript ‘gen’. Consequently there are ‘adjusted’ values, denoted
with superscript ‘adj’.</p>
</div>
<div class="section level3">
<h3 id="background-mortality-survival-and-hazard-functions">Background mortality survival and hazard functions<a class="anchor" aria-label="anchor" href="#background-mortality-survival-and-hazard-functions"></a>
</h3>
<p>Our lifetable gives us decreasing
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>l</mi><mi>x</mi></msub><annotation encoding="application/x-tex">l_x</annotation></semantics></math>
values at points between
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>t</mi><mo>=</mo><mn>0</mn><mo>,</mo><mi>.</mi><mi>.</mi><mi>.</mi><mo>,</mo><msub><mi>t</mi><mrow><mi>m</mi><mi>a</mi><mi>x</mi></mrow></msub></mrow><annotation encoding="application/x-tex">t=0, ..., t_{max}</annotation></semantics></math>,
with
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>l</mi><msub><mi>t</mi><mrow><mi>m</mi><mi>a</mi><mi>x</mi></mrow></msub></msub><mo>=</mo><mn>0</mn></mrow><annotation encoding="application/x-tex">l_{t_{max}}=0</annotation></semantics></math>.
Let us define the background mortality survival function as follows.</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>S</mi><mrow><mi>g</mi><mi>e</mi><mi>n</mi></mrow></msub><mrow><mo stretchy="true" form="prefix">(</mo><mi>t</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><mn>1</mn><mo>−</mo><mi>R</mi><mrow><mo stretchy="true" form="prefix">(</mo><mn>1</mn><mo>−</mo><mfrac><msub><mi>l</mi><mrow><msub><mi>x</mi><mn>0</mn></msub><mo>+</mo><mi>t</mi></mrow></msub><msub><mi>l</mi><msub><mi>x</mi><mn>0</mn></msub></msub></mfrac><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">
S_{gen}(t) = 1 - R \left(1 - \frac{l_{x_0 + t}}{l_{x_0}} \right)
</annotation></semantics></math></p>
<p>where
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>x</mi><mn>0</mn></msub><annotation encoding="application/x-tex">x_0</annotation></semantics></math>
is the mean age of the study population at baseline,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>R</mi><annotation encoding="application/x-tex">R</annotation></semantics></math>
is a <a href="https://en.wikipedia.org/wiki/Standardized_mortality_ratio" class="external-link">Standardized
Mortality Ratio</a>, and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>l</mi><mi>x</mi></msub><annotation encoding="application/x-tex">l_x</annotation></semantics></math>
is an appropriate lifetable.</p>
<p>We can also derive the average background mortality hazard for
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>t</mi><annotation encoding="application/x-tex">t</annotation></semantics></math>
in the range
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false" form="prefix">[</mo><msub><mi>t</mi><mn>1</mn></msub><mo>,</mo><msub><mi>t</mi><mn>2</mn></msub><mo stretchy="false" form="postfix">)</mo></mrow><annotation encoding="application/x-tex">[t_1, t_2)</annotation></semantics></math>.</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>h</mi><mrow><mi>g</mi><mi>e</mi><mi>n</mi></mrow></msub><mrow><mo stretchy="true" form="prefix">(</mo><mi>t</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><mfrac><mrow><mo>log</mo><mrow><mo stretchy="true" form="prefix">[</mo><msub><mi>S</mi><mrow><mi>g</mi><mi>e</mi><mi>n</mi></mrow></msub><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>t</mi><mn>1</mn></msub><mo stretchy="true" form="postfix">)</mo></mrow><mo stretchy="true" form="postfix">]</mo></mrow><mo>−</mo><mo>log</mo><mrow><mo stretchy="true" form="prefix">[</mo><msub><mi>S</mi><mrow><mi>g</mi><mi>e</mi><mi>n</mi></mrow></msub><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>t</mi><mn>2</mn></msub><mo stretchy="true" form="postfix">)</mo></mrow><mo stretchy="true" form="postfix">]</mo></mrow></mrow><mrow><msub><mi>t</mi><mn>2</mn></msub><mo>−</mo><msub><mi>t</mi><mn>1</mn></msub></mrow></mfrac></mrow><annotation encoding="application/x-tex">
h_{gen}(t) = \frac{\log[S_{gen}(t_1)] - \log[S_{gen}(t_2)]}{t_2 - t_1}
</annotation></semantics></math></p>
</div>
</div>
<div class="section level2">
<h2 id="what-does-constraining-for-background-mortality-mean">What does constraining for background mortality mean?<a class="anchor" aria-label="anchor" href="#what-does-constraining-for-background-mortality-mean"></a>
</h2>
<p>There are a number of approaches applied in literature and HTA
submissions, so it could mean several things!</p>
<div class="section level3">
<h3 id="approach-1---constraining-only-the-survival-function">Approach 1 - Constraining only the survival function<a class="anchor" aria-label="anchor" href="#approach-1---constraining-only-the-survival-function"></a>
</h3>
<p>Under this approach, the background mortality is assumed to limit the
survival function as follows. There is no direct constraint to the
hazard.</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mi>S</mi><mrow><mi>a</mi><mi>d</mi><mi>j</mi></mrow></msup><mrow><mo stretchy="true" form="prefix">(</mo><mi>t</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><mo>min</mo><mrow><mo stretchy="true" form="prefix">[</mo><mi>S</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>t</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>,</mo><msub><mi>S</mi><mrow><mi>g</mi><mi>e</mi><mi>n</mi></mrow></msub><mrow><mo stretchy="true" form="prefix">(</mo><mi>t</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo stretchy="true" form="postfix">]</mo></mrow></mrow><annotation encoding="application/x-tex">
S^{adj}(t) = \min \left[ S(t), S_{gen}(t) \right]
</annotation></semantics></math></p>
<p>This is a simple approach, and has been used at least one NICE
technology appraisal <span class="citation">(National Institute for
Health and Care Excellence 2022)</span>:</p>
<blockquote>
<p>“Patient longevity is always the lesser of values generated from the
disease-specific survival curve (after adjustment for treatment and
functional status) and the survival curve for the general population
according to age and sex.”</p>
</blockquote>
<p>However, this approach does not ensure that the hazard is at least as
great as the hazard of background mortality.</p>
</div>
<div class="section level3">
<h3 id="approach-2---constraining-the-hazard-function">Approach 2 - Constraining the hazard function<a class="anchor" aria-label="anchor" href="#approach-2---constraining-the-hazard-function"></a>
</h3>
<p>A more rigorous adjustment would be that the hazard of background
mortality acts as a constraint to the unadjusted hazard <span class="citation">(Sweeting et al. 2023)</span>.</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mi>h</mi><mrow><mi>a</mi><mi>d</mi><mi>j</mi></mrow></msup><mrow><mo stretchy="true" form="prefix">(</mo><mi>t</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><mo>max</mo><mrow><mo stretchy="true" form="prefix">[</mo><mi>h</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>t</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>,</mo><msub><mi>h</mi><mrow><mi>g</mi><mi>e</mi><mi>n</mi></mrow></msub><mrow><mo stretchy="true" form="prefix">(</mo><mi>t</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo stretchy="true" form="postfix">]</mo></mrow></mrow><annotation encoding="application/x-tex">
h^{adj}(t) = \max \left[ h(t), h_{gen}(t) \right]
</annotation></semantics></math><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>⟹</mo><msup><mi>S</mi><mrow><mi>a</mi><mi>d</mi><mi>j</mi></mrow></msup><mrow><mo stretchy="true" form="prefix">(</mo><mi>t</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><mo>exp</mo><mrow><mo stretchy="true" form="prefix">[</mo><mo>−</mo><msubsup><mo>∫</mo><mn>0</mn><mi>t</mi></msubsup><msup><mi>h</mi><mrow><mi>a</mi><mi>d</mi><mi>j</mi></mrow></msup><mrow><mo stretchy="true" form="prefix">(</mo><mi>u</mi><mo stretchy="true" form="postfix">)</mo></mrow><mi>d</mi><mi>u</mi><mo stretchy="true" form="postfix">]</mo></mrow></mrow><annotation encoding="application/x-tex">
\implies S^{adj}(t) = \exp \left[ - \int_0^t h^{adj}(u) du \right]
</annotation></semantics></math></p>
<p>In either case, we must assume that the original dataset was NOT
subject to background mortality. Although unlikely to be true, this is a
common, pragmatic assumption in cost-effectiveness models as long as
background mortality is relatively insignificant during trial
follow-up.</p>
</div>
<div class="section level3">
<h3 id="approach-3---modeling-excess-hazard-in-the-original-dataset">Approach 3 - Modeling excess hazard in the original dataset<a class="anchor" aria-label="anchor" href="#approach-3---modeling-excess-hazard-in-the-original-dataset"></a>
</h3>
<p>The above approaches work by adjusting extrapolations made from
models fitted to data assumed to be not subject to background mortality.
If - as is likely - the population in the dataset were in fact subject
to background mortality, then it would be better to model that dataset
using excess hazard methods rather than to seek to make adjustments to
extrapolations after the fact. Further discussion of survival
extrapolation incorporating general population mortality is provided by
<span class="citation">Sweeting et al. (2023)</span>.</p>
</div>
</div>
<div class="section level2">
<h2 id="application-to-3-state-state-transition-models-stms">Application to 3-state State Transition Models (STMs)<a class="anchor" aria-label="anchor" href="#application-to-3-state-state-transition-models-stms"></a>
</h2>
<p>As discussed previously, state transition models with three states
may be clock forward (‘STM-CF’) or ‘clock reset’ (STM-CR). Such
structures involve modeling each transition directly, which may be
performed by fitting survival distributions to the TTP, PPD and PPS
endpoints.</p>
<p>In general, we wish to constrain the pre- and post-progression
mortality (PPD and PPS) are at least as great as background
mortality.</p>
<p><span class="math display">$$
h^{adj}_{PPD}(t) = \max \left[h_{gen}(t), h_{PPD}(t) \right] \\
h^{adj}_{PPS}(t) = \max \left[h_{gen}(t), h_{PPS}(t) \right] \\
$$</span></p>
<p>Formulas for the mean time in PF and OS are shown in the accompanying
article in respect of hazard and survival functions for TTP, PPD and PPS
endpoints, where PPS is a function of time from baseline in a Clock
Forward (CF) and time from progression in a Clock Reset (CR) model.
Adjusting for background mortality requires using the adjusted rather
than unadjusted hazards for PPD and PPS in formulae.</p>
<p>This is straightforward enough for the PPD endpoint in the STM-CF and
STM-CR structures, and for the PPS endpoint in the STM-CF structure.
However matters are more complex for the PPS endpoint for the STM-CF
since its hazard and survival are functions of two times (time from
progression and time from baseline) rather than just one (time from
baseline). This package does not provide integral solutions relying on
continuous time for RMDs, and must instead rely on discretization.</p>
<p>Spreadsheet-based economic models almost always rely on discretizing
time into timesteps rather than follow the integral formulas described
above for continuous time. As long as timesteps are reasonably short,
restricted mean duration results should remain reasonably accurate.
Derided as a “kludge”, half-cycle corrections are nevertheless
recommended <span class="citation">(Naimark, Kabboul, and Krahn
2013)</span>. The package provides discretized calculations.</p>
</div>
<div class="section level2">
<h2 id="application-to-partitioned-survival-models-psm">Application to Partitioned Survival Models (PSM)<a class="anchor" aria-label="anchor" href="#application-to-partitioned-survival-models-psm"></a>
</h2>
<p>The RMD in the PF state and time alive are integrals over the time
horizon,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>T</mi><annotation encoding="application/x-tex">T</annotation></semantics></math>,
of the survival functions of the endpoints PFS and OS. Endpoints PPD and
PPS are not explicitly defined.</p>
<p>However as discussed in the accompanying manuscript, TTP - and
therefore the PPD and PPS endpoints which directly follow once PFS and
OS are defined - are often in practice implicitly defined in PSM
economic model in order to calculate payoffs that depend on progression
events. Two methods are possible:</p>
<ul>
<li><p>Simple (default): the hazard of TTP relative to PFS is
proportionate to the progression events observed over the follow-up
period relative to the total number of observed PFS events.</p></li>
<li><p>Complex: the hazard of TTP is directly modeled by fitting
survival distributions as with other endpoints.</p></li>
</ul>
<p>The adjustment to RMD estimates can then proceed as with the STMs,
with hazards and survival functions of TTP, PPD and PPS that reflect the
PSM structure (in which PFS and OS endpoints are first estimated), a
chosen model of progression (simple or complex), and then finally the
adjustment to PPD and PPS for background mortality.</p>
</div>
<div class="section level2">
<h2 id="illustration-of-calculations">Illustration of calculations<a class="anchor" aria-label="anchor" href="#illustration-of-calculations"></a>
</h2>
<div class="section level3">
<h3 id="set-up">Set-up<a class="anchor" aria-label="anchor" href="#set-up"></a>
</h3>
<p>First we load the packages we need - all of which are suggested for
or imported to <em>psm3mkv</em>. If you haven’t installed
<em>psm3mkv</em> yet, please see the <a href="https://github.com/Merck/psm3mkv?tab=readme-ov-file#installation" class="external-link">installation
instructions</a> to install it with its dependencies. Of these, we will
making further use of <span class="citation">Wickham et al.
(2023)</span>, <span class="citation">Riffe (2015)</span> and <span class="citation">Müller and Wickham (2023)</span>.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="st"><a href="https://dplyr.tidyverse.org" class="external-link">"dplyr"</a></span><span class="op">)</span></span>
<span><span class="co">#&gt; Error in get(paste0(generic, ".", class), envir = get_method_env()) : </span></span>
<span><span class="co">#&gt;   object 'type_sum.accel' not found</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="st"><a href="https://merck.github.io/psm3mkv/">"psm3mkv"</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="st"><a href="https://tibble.tidyverse.org/" class="external-link">"tibble"</a></span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="creating-the-life-table">Creating the life table<a class="anchor" aria-label="anchor" href="#creating-the-life-table"></a>
</h3>
<p>In order to apply constraints to background mortality, we need some
background mortality data, in the form of a lifetable. We can take this
from the Human Mortality Database using the <em>HMDHFDplus</em> package
mentioned above (with thanks to Robert Hettle for the recommendation).
The lifetable will need to start from an assumed age at baseline.
Lifetables are constructed by time in years.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># HMD HFD package</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="st"><a href="https://github.com/timriffe/TR1" class="external-link">"HMDHFDplus"</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Assumed population age at baseline (time=0)</span></span>
<span><span class="va">baseage</span> <span class="op">&lt;-</span> <span class="fl">51.0</span></span>
<span></span>
<span><span class="co"># Mortality data - England &amp; Wales, Female, 2019</span></span>
<span><span class="va">mort</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/HMDHFDplus/man/readHMDweb.html" class="external-link">readHMDweb</a></span><span class="op">(</span></span>
<span>  CNTRY <span class="op">=</span> <span class="st">"GBRTENW"</span>,</span>
<span>  item <span class="op">=</span> <span class="st">"fltper_1x1"</span>,</span>
<span>  username <span class="op">=</span> <span class="st">""</span>,</span>
<span>  password <span class="op">=</span> <span class="st">""</span></span>
<span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">Year</span> <span class="op">==</span> <span class="fl">2019</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">Age</span>, <span class="va">lx</span>, <span class="va">dx</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>Timey <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">ceiling</a></span><span class="op">(</span><span class="va">Age</span> <span class="op">-</span> <span class="va">baseage</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">Timey</span> <span class="op">&gt;=</span> <span class="fl">0</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># The table needs to end with lx=0</span></span>
<span><span class="va">mort</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/add_row.html" class="external-link">add_row</a></span><span class="op">(</span><span class="va">mort</span>, Age <span class="op">=</span> <span class="fl">111</span>, lx <span class="op">=</span> <span class="fl">0</span>, Timey <span class="op">=</span> <span class="fl">60</span><span class="op">)</span></span></code></pre></div>
<p>You will see that the above code cannot run without a login for the
<a href="https://www.mortality.org" class="external-link">Human Mortality Database</a>.
Alternatively, we could just make up a mortality table.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mort</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html" class="external-link">tibble</a></span><span class="op">(</span></span>
<span>  Timey <span class="op">=</span> <span class="fl">0</span><span class="op">:</span><span class="fl">30</span>,</span>
<span>  lx <span class="op">=</span> <span class="fl">10000</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="op">-</span><span class="fl">0.03</span> <span class="op">*</span> <span class="va">Timey</span><span class="op">^</span><span class="fl">1.1</span><span class="op">)</span>,</span>
<span>  dx <span class="op">=</span> <span class="va">lx</span> <span class="op">-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/lead-lag.html" class="external-link">lead</a></span><span class="op">(</span><span class="va">lx</span><span class="op">)</span>,</span>
<span>  qx <span class="op">=</span> <span class="va">dx</span> <span class="op">/</span> <span class="va">lx</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>However we do it, once we have the mortality data, we can apply the
SMR
(<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>R</mi><annotation encoding="application/x-tex">R</annotation></semantics></math>)
and derive a lifetable from time zero as required.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Assumed Standardized Mortality Ratio</span></span>
<span><span class="va">SMR</span> <span class="op">&lt;-</span> <span class="fl">2</span></span>
<span></span>
<span><span class="co"># Recalculate the lifetable with the SMR applied</span></span>
<span><span class="va">mort</span><span class="op">$</span><span class="va">adjlx</span> <span class="op">&lt;-</span> <span class="va">mort</span><span class="op">$</span><span class="va">lx</span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">2</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">mort</span><span class="op">$</span><span class="va">lx</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">mort</span><span class="op">$</span><span class="va">adjlx</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">mort</span><span class="op">$</span><span class="va">adjlx</span><span class="op">[</span><span class="va">i</span> <span class="op">-</span> <span class="fl">1</span><span class="op">]</span> <span class="op">*</span> <span class="op">(</span><span class="fl">1</span> <span class="op">-</span> <span class="va">SMR</span> <span class="op">*</span> <span class="va">mort</span><span class="op">$</span><span class="va">qx</span><span class="op">[</span><span class="va">i</span> <span class="op">-</span> <span class="fl">1</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># Ensure lx&gt;=0</span></span>
<span><span class="va">mort</span><span class="op">$</span><span class="va">adjlx</span><span class="op">[</span><span class="va">mort</span><span class="op">$</span><span class="va">adjlx</span> <span class="op">&lt;</span> <span class="fl">0</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">0</span></span>
<span></span>
<span><span class="co"># Create and view lifetable</span></span>
<span><span class="va">ltable</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html" class="external-link">tibble</a></span><span class="op">(</span>lttime <span class="op">=</span> <span class="va">mort</span><span class="op">$</span><span class="va">Timey</span>, lx <span class="op">=</span> <span class="va">mort</span><span class="op">$</span><span class="va">adjlx</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">ltable</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 6 × 2</span></span></span>
<span><span class="co">#&gt;   lttime     lx</span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span>      0 <span style="text-decoration: underline;">10</span>000 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span>      1  <span style="text-decoration: underline;">9</span>409.</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span>      2  <span style="text-decoration: underline;">8</span>774.</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span>      3  <span style="text-decoration: underline;">8</span>151.</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">5</span>      4  <span style="text-decoration: underline;">7</span>553.</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">6</span>      5  <span style="text-decoration: underline;">6</span>985.</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="obtaining-and-fitting-distributions-to-patient-level-data">Obtaining and fitting distributions to patient-level data<a class="anchor" aria-label="anchor" href="#obtaining-and-fitting-distributions-to-patient-level-data"></a>
</h3>
<p>Next we get some patient-level data and fit the PSM and STMs. So far,
we are closely following <code><a href="../articles/example.html">vignette("example")</a></code>. Time is
assumed to be recorded in the patient-level data in weeks, with
approximately 52.18 weeks per year.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Get some data</span></span>
<span><span class="va">bosonc</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/create_dummydata.html">create_dummydata</a></span><span class="op">(</span><span class="st">"flexbosms"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># We'll make the durations a lot longer</span></span>
<span><span class="co"># so that they will be definitely constrained by the lifetable</span></span>
<span><span class="va">bosonc</span> <span class="op">&lt;-</span> <span class="va">bosonc</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>    pfs.durn <span class="op">=</span> <span class="fl">20</span> <span class="op">*</span> <span class="va">pfs.durn</span>,</span>
<span>    os.durn <span class="op">=</span> <span class="fl">20</span> <span class="op">*</span> <span class="va">os.durn</span>,</span>
<span>    ttp.durn <span class="op">=</span> <span class="fl">20</span> <span class="op">*</span> <span class="va">ttp.durn</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="co"># Fit parametric models to each endpoint</span></span>
<span><span class="va">allfits</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/fit_ends_mods_par.html">fit_ends_mods_par</a></span><span class="op">(</span><span class="va">bosonc</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Bring together preferred fits for each endpoint</span></span>
<span><span class="va">params</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>  ppd <span class="op">=</span> <span class="fu"><a href="../reference/find_bestfit.html">find_bestfit</a></span><span class="op">(</span><span class="va">allfits</span><span class="op">$</span><span class="va">ppd</span>, <span class="st">"aic"</span><span class="op">)</span><span class="op">$</span><span class="va">fit</span>,</span>
<span>  ttp <span class="op">=</span> <span class="fu"><a href="../reference/find_bestfit.html">find_bestfit</a></span><span class="op">(</span><span class="va">allfits</span><span class="op">$</span><span class="va">ttp</span>, <span class="st">"aic"</span><span class="op">)</span><span class="op">$</span><span class="va">fit</span>,</span>
<span>  pfs <span class="op">=</span> <span class="fu"><a href="../reference/find_bestfit.html">find_bestfit</a></span><span class="op">(</span><span class="va">allfits</span><span class="op">$</span><span class="va">pfs</span>, <span class="st">"aic"</span><span class="op">)</span><span class="op">$</span><span class="va">fit</span>,</span>
<span>  os <span class="op">=</span> <span class="fu"><a href="../reference/find_bestfit.html">find_bestfit</a></span><span class="op">(</span><span class="va">allfits</span><span class="op">$</span><span class="va">os</span>, <span class="st">"aic"</span><span class="op">)</span><span class="op">$</span><span class="va">fit</span>,</span>
<span>  pps_cf <span class="op">=</span> <span class="fu"><a href="../reference/find_bestfit.html">find_bestfit</a></span><span class="op">(</span><span class="va">allfits</span><span class="op">$</span><span class="va">pps_cf</span>, <span class="st">"aic"</span><span class="op">)</span><span class="op">$</span><span class="va">fit</span>,</span>
<span>  pps_cr <span class="op">=</span> <span class="fu"><a href="../reference/find_bestfit.html">find_bestfit</a></span><span class="op">(</span><span class="va">allfits</span><span class="op">$</span><span class="va">pps_cr</span>, <span class="st">"aic"</span><span class="op">)</span><span class="op">$</span><span class="va">fit</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="making-the-projections">Making the projections<a class="anchor" aria-label="anchor" href="#making-the-projections"></a>
</h3>
<p>We are skipping over any internal or external validation for the
purposes of this vignette, and jump instead straight to making the
survival projections. We will assume a 10 year time horizon.</p>
<p>First we derive a projection using integral formulae, without
lifetable constraints.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Set time horizon</span></span>
<span><span class="va">thoz</span> <span class="op">&lt;-</span> <span class="fl">10</span></span>
<span></span>
<span><span class="co"># Run the calculations</span></span>
<span><span class="va">proj1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/calc_allrmds.html">calc_allrmds</a></span><span class="op">(</span><span class="va">bosonc</span>, dpam <span class="op">=</span> <span class="va">params</span>, Ty <span class="op">=</span> <span class="va">thoz</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Present the results</span></span>
<span><span class="va">res1</span> <span class="op">&lt;-</span> <span class="va">proj1</span><span class="op">$</span><span class="va">results</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>method <span class="op">=</span> <span class="st">"int"</span>, lxadj <span class="op">=</span> <span class="st">"no"</span>, psmmeth <span class="op">=</span> <span class="st">"simple"</span><span class="op">)</span></span>
<span><span class="va">res1</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/across.html" class="external-link">across</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">pf</span>, <span class="va">pd</span>, <span class="va">os</span><span class="op">)</span>, <span class="op">~</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/num.html" class="external-link">num</a></span><span class="op">(</span><span class="va">.x</span>, digits <span class="op">=</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 3 × 7</span></span></span>
<span><span class="co">#&gt;          pf        pd        os model  method lxadj psmmeth</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;num:.1!&gt;</span> <span style="color: #949494; font-style: italic;">&lt;num:.1!&gt;</span> <span style="color: #949494; font-style: italic;">&lt;num:.1!&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span>     274.4     118.3     392.7 PSM    int    no    simple </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span>     270.2     119.7     389.9 STM-CF int    no    simple </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span>     270.2     123.8     393.9 STM-CR int    no    simple</span></span></code></pre></div>
<p>Next we derive a projection using a discretization approximation,
still without any lifetable constraints.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Run the calculation</span></span>
<span><span class="va">proj2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/calc_allrmds.html">calc_allrmds</a></span><span class="op">(</span><span class="va">bosonc</span>, dpam <span class="op">=</span> <span class="va">params</span>, Ty <span class="op">=</span> <span class="va">thoz</span>, rmdmethod <span class="op">=</span> <span class="st">"disc"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Present the results</span></span>
<span><span class="va">res2</span> <span class="op">&lt;-</span> <span class="va">proj2</span><span class="op">$</span><span class="va">results</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>method <span class="op">=</span> <span class="st">"disc"</span>, lxadj <span class="op">=</span> <span class="st">"no"</span>, psmmeth <span class="op">=</span> <span class="st">"simple"</span><span class="op">)</span></span>
<span><span class="va">res2</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/across.html" class="external-link">across</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">pf</span>, <span class="va">pd</span>, <span class="va">os</span><span class="op">)</span>, <span class="op">~</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/num.html" class="external-link">num</a></span><span class="op">(</span><span class="va">.x</span>, digits <span class="op">=</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 3 × 7</span></span></span>
<span><span class="co">#&gt;          pf        pd        os model  method lxadj psmmeth</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;num:.1!&gt;</span> <span style="color: #949494; font-style: italic;">&lt;num:.1!&gt;</span> <span style="color: #949494; font-style: italic;">&lt;num:.1!&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span>     274.3     118.3     392.6 PSM    disc   no    simple </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span>     270.1     119.7     389.8 STM-CF disc   no    simple </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span>     270.1     123.7     393.8 STM-CR disc   no    simple</span></span></code></pre></div>
<p>Discretization has proven fairly accurate. The STM-CR estimate of
mean time alive has reduced by just 0.1 weeks for example, from 393.9 to
393.8 weeks.</p>
<p>Finally, we use a discretization approximation and apply the
lifetable constraints.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Run the calculations</span></span>
<span><span class="va">proj3</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/calc_allrmds.html">calc_allrmds</a></span><span class="op">(</span><span class="va">bosonc</span>, dpam <span class="op">=</span> <span class="va">params</span>, Ty <span class="op">=</span> <span class="va">thoz</span>, rmdmethod <span class="op">=</span> <span class="st">"disc"</span>, lifetable <span class="op">=</span> <span class="va">ltable</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Present the results</span></span>
<span><span class="va">res3</span> <span class="op">&lt;-</span> <span class="va">proj3</span><span class="op">$</span><span class="va">results</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>method <span class="op">=</span> <span class="st">"disc"</span>, lxadj <span class="op">=</span> <span class="st">"yes"</span>, psmmeth <span class="op">=</span> <span class="st">"simple"</span><span class="op">)</span></span>
<span><span class="va">res3</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/across.html" class="external-link">across</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">pf</span>, <span class="va">pd</span>, <span class="va">os</span><span class="op">)</span>, <span class="op">~</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/num.html" class="external-link">num</a></span><span class="op">(</span><span class="va">.x</span>, digits <span class="op">=</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 3 × 7</span></span></span>
<span><span class="co">#&gt;          pf        pd        os model  method lxadj psmmeth</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;num:.1!&gt;</span> <span style="color: #949494; font-style: italic;">&lt;num:.1!&gt;</span> <span style="color: #949494; font-style: italic;">&lt;num:.1!&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span>     235.4     105.5     340.9 PSM    disc   yes   simple </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span>     230.1     107.6     337.7 STM-CF disc   yes   simple </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span>     230.1     111.6     341.6 STM-CR disc   yes   simple</span></span>
<span></span>
<span><span class="co"># Proportion of time alive spent in PF</span></span>
<span><span class="va">proppf3</span> <span class="op">&lt;-</span> <span class="va">res3</span><span class="op">$</span><span class="va">pf</span> <span class="op">/</span> <span class="va">res3</span><span class="op">$</span><span class="va">os</span></span></code></pre></div>
<p>There is now some difference between the STM-CR compared to the
STM-CF and PSM structures. All structures estimate fairly similar RMD
estimates of being alive (range: 337.7 to 341.6 weeks). The estimate of
mean time alive in the STM-CR structure has reduced by 52.3 weeks from
393.9 to 341.6 weeks.</p>
<p>The proportion of that time in the PF rather than PD state varies
somewhat (PSM: 69%, STM-CF: 68.1%, STM-CR: 67.3%). Given that the hazard
of mortality would typically be lower before rather than after
progression, the pre-progression mortality is likely to be more affected
by any mortality constraint that post-progression mortality. The STM-CR
model of post-progression survival depends on time from progression and
is therefore rather different from the STM-CF and PSM structures, which
model mortality based on time from baseline.</p>
<p>We can check whether using a ‘complex’ type of PSM structure rather
than the default ‘simple’ affects RMD estimates from the PSM
structure.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Run the calculations</span></span>
<span><span class="va">proj4</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/calc_allrmds.html">calc_allrmds</a></span><span class="op">(</span><span class="va">bosonc</span>, dpam <span class="op">=</span> <span class="va">params</span>, Ty <span class="op">=</span> <span class="va">thoz</span>, psmtype <span class="op">=</span> <span class="st">"complex"</span>, rmdmethod <span class="op">=</span> <span class="st">"disc"</span>, lifetable <span class="op">=</span> <span class="va">ltable</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Present the results</span></span>
<span><span class="va">res4</span> <span class="op">&lt;-</span> <span class="va">proj4</span><span class="op">$</span><span class="va">results</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>method <span class="op">=</span> <span class="st">"disc"</span>, lxadj <span class="op">=</span> <span class="st">"yes"</span>, psmmeth <span class="op">=</span> <span class="st">"complex"</span><span class="op">)</span></span>
<span><span class="va">res4</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/across.html" class="external-link">across</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">pf</span>, <span class="va">pd</span>, <span class="va">os</span><span class="op">)</span>, <span class="op">~</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/num.html" class="external-link">num</a></span><span class="op">(</span><span class="va">.x</span>, digits <span class="op">=</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 3 × 7</span></span></span>
<span><span class="co">#&gt;          pf        pd        os model  method lxadj psmmeth</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;num:.1!&gt;</span> <span style="color: #949494; font-style: italic;">&lt;num:.1!&gt;</span> <span style="color: #949494; font-style: italic;">&lt;num:.1!&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span>     231.0     103.7     334.7 PSM    disc   yes   complex</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span>     230.1     107.6     337.7 STM-CF disc   yes   complex</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span>     230.1     111.6     341.6 STM-CR disc   yes   complex</span></span>
<span></span>
<span><span class="co"># Proportion of time alive spent in PF</span></span>
<span><span class="va">proppf4</span> <span class="op">&lt;-</span> <span class="va">res4</span><span class="op">$</span><span class="va">pf</span> <span class="op">/</span> <span class="va">res4</span><span class="op">$</span><span class="va">os</span></span></code></pre></div>
<p>All structures estimate fairly similar RMD estimates of being alive
(range: 334.7 to 341.6 weeks). The proportion of that time in the PF
rather than PD state varied a little by model structure (PSM: 69%,
STM-CF: 68.1%, STM-CR: 67.3%).</p>
</div>
<div class="section level3">
<h3 id="comparing-the-results">Comparing the results<a class="anchor" aria-label="anchor" href="#comparing-the-results"></a>
</h3>
<p>A summary of the STM-CF estimates of mean time in PF state and mean
time alive is given in the table below.</p>
<table class="table">
<colgroup>
<col width="26%">
<col width="18%">
<col width="18%">
<col width="18%">
<col width="18%">
</colgroup>
<thead><tr class="header">
<th align="left">Model</th>
<th align="left">Mean time in PF (weeks)</th>
<th align="left">Change (weeks)</th>
<th align="left">Mean time alive (weeks)</th>
<th align="left">Change (weeks)</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">No lifetable constraint, integral methods</td>
<td align="left">270.2</td>
<td align="left">-</td>
<td align="left">389.9</td>
<td align="left">-</td>
</tr>
<tr class="even">
<td align="left">No lifetable constraint, discretized calculation</td>
<td align="left">270.1</td>
<td align="left">-0.1</td>
<td align="left">389.8</td>
<td align="left">-0.1</td>
</tr>
<tr class="odd">
<td align="left">With lifetable constraint, discretized calculation</td>
<td align="left">230.1</td>
<td align="left">-40.1</td>
<td align="left">337.7</td>
<td align="left">-52.2</td>
</tr>
</tbody>
</table>
<p>In this fictional case, the application of a lifetable constraint had
fairly sizeable effects on the results - although this was by design of
this demonstration.</p>
<p>A summary of the STM-CR estimates of mean time in PF state and mean
time alive is given in the table below.</p>
<table class="table">
<colgroup>
<col width="26%">
<col width="18%">
<col width="18%">
<col width="18%">
<col width="18%">
</colgroup>
<thead><tr class="header">
<th align="left">Model</th>
<th align="left">Mean time in PF (weeks)</th>
<th align="left">Change (weeks)</th>
<th align="left">Mean time alive (weeks)</th>
<th align="left">Change (weeks)</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">No lifetable constraint, integral methods</td>
<td align="left">270.2</td>
<td align="left">-</td>
<td align="left">393.9</td>
<td align="left">-</td>
</tr>
<tr class="even">
<td align="left">No lifetable constraint, discretized calculation</td>
<td align="left">270.1</td>
<td align="left">-0.1</td>
<td align="left">393.8</td>
<td align="left">-0.1</td>
</tr>
<tr class="odd">
<td align="left">With lifetable constraint, discretized calculation</td>
<td align="left">230.1</td>
<td align="left">-40.1</td>
<td align="left">341.6</td>
<td align="left">-52.3</td>
</tr>
</tbody>
</table>
<p>The application of a lifetable constraint had similar and fairly
sizeable effects on the results here also.</p>
<p>A summary of the PSM estimates of mean time in PF state and mean time
alive is given in the table below.</p>
<table class="table">
<colgroup>
<col width="26%">
<col width="18%">
<col width="18%">
<col width="18%">
<col width="18%">
</colgroup>
<thead><tr class="header">
<th align="left">Model</th>
<th align="left">Mean time in PF (weeks)</th>
<th align="left">Change (weeks)</th>
<th align="left">Mean time alive (weeks)</th>
<th align="left">Change (weeks)</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">No lifetable constraint, integral methods, simple
PSM</td>
<td align="left">274.4</td>
<td align="left">-</td>
<td align="left">392.7</td>
<td align="left">-</td>
</tr>
<tr class="even">
<td align="left">No lifetable constraint, discretized calculation,
simple PSM</td>
<td align="left">274.3</td>
<td align="left">-0.1</td>
<td align="left">392.6</td>
<td align="left">-0.1</td>
</tr>
<tr class="odd">
<td align="left">With lifetable constraint, discretized calculation,
simple PSM</td>
<td align="left">235.4</td>
<td align="left">-39</td>
<td align="left">340.9</td>
<td align="left">-51.8</td>
</tr>
<tr class="even">
<td align="left">With lifetable constraint, discretized calculation,
complex PSM</td>
<td align="left">231</td>
<td align="left">-43.4</td>
<td align="left">334.7</td>
<td align="left">-58.1</td>
</tr>
</tbody>
</table>
<p>The change in the RMDs for the ‘complex’ PSM structure compared to
the ‘simple’ PSM structure were -4.3, -1.9 and -6.2 weeks respectively
for time in PF state, PD state and time alive.</p>
</div>
<div class="section level3">
<h3 id="possible-extensions">Possible extensions<a class="anchor" aria-label="anchor" href="#possible-extensions"></a>
</h3>
<p>Not applied here, the package also allows application of discounting
through the <code>discrate</code> optional call to
<code>calc_allrnds()</code>. This work could also be easily extended
through calculating RMDs or Life Years that are Quality Adjusted
(QALYs).</p>
</div>
</div>
<div class="section level2 unnumbered">
<h2 class="unnumbered" id="references">References<a class="anchor" aria-label="anchor" href="#references"></a>
</h2>
<div id="refs" class="references csl-bib-body hanging-indent" entry-spacing="0">
<div id="ref-jackson2016flexsurv" class="csl-entry">
Jackson, Christopher. 2016. <span>“<span class="nocase">flexsurv</span>:
A Platform for Parametric Survival Modeling in <span>R</span>.”</span>
<em>Journal of Statistical Software</em> 70 (8): 1–33.
</div>
<div id="ref-pack_tibble" class="csl-entry">
Müller, Kirill, and Hadley Wickham. 2023. <em><span class="nocase">tibble</span>: Simple Data Frames</em>. <a href="https://CRAN.R-project.org/package=tibble" class="external-link">https://CRAN.R-project.org/package=tibble</a>.
</div>
<div id="ref-muston2024informing" class="csl-entry">
Muston, Dominic. 2024. <span>“Informing Structural Assumptions for Three
State Oncology Cost-Effectiveness Models Through Model Efficiency and
Fit.”</span> <em>Applied Health Economics and Health Policy</em>. <a href="https://doi.org/10.1007/s40258-024-00884-2" class="external-link">https://doi.org/10.1007/s40258-024-00884-2</a>.
</div>
<div id="ref-naimark2013half" class="csl-entry">
Naimark, David MJ, Nader N Kabboul, and Murray D Krahn. 2013. <span>“The
Half-Cycle Correction Revisited: Redemption of a Kludge.”</span>
<em>Medical Decision Making</em> 33 (7): 961–70.
</div>
<div id="ref-nice2022" class="csl-entry">
National Institute for Health and Care Excellence. 2022.
<span>“Avalglucosidase Alfa for Treating <span>Pompe</span>
Disease.”</span> Technology appraisal guidance TA821. London, UK:
National Institute for Health; Care Excellence. <a href="https://www.nice.org.uk/guidance/ta821/documents/committee-papers" class="external-link">https://www.nice.org.uk/guidance/ta821/documents/committee-papers</a>.
</div>
<div id="ref-pack_HMDHFDplus" class="csl-entry">
Riffe, Tim. 2015. <span>“Reading Human Fertility Database and Human
Mortality Database Data into <span>R</span>.”</span> TR-2015-004. MPIDR.
<a href="https://doi.org/10.4054/MPIDR-TR-2015-004" class="external-link">https://doi.org/10.4054/MPIDR-TR-2015-004</a>.
</div>
<div id="ref-sweeting2023survival" class="csl-entry">
Sweeting, Michael J, Mark J Rutherford, Dan Jackson, Sangyu Lee,
Nicholas R Latimer, Robert Hettle, and Paul C Lambert. 2023.
<span>“Survival Extrapolation Incorporating General Population Mortality
Using Excess Hazard and Cure Models: A Tutorial.”</span> <em>Medical
Decision Making</em> 43 (6): 737–48.
</div>
<div id="ref-pack_dplyr" class="csl-entry">
Wickham, Hadley, Romain François, Lionel Henry, Kirill Müller, and Davis
Vaughan. 2023. <em><span class="nocase">dplyr</span>: A Grammar of Data
Manipulation</em>. <a href="https://CRAN.R-project.org/package=dplyr" class="external-link">https://CRAN.R-project.org/package=dplyr</a>.
</div>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Dominic Muston, Merck &amp; Co., Inc., Rahway, NJ, USA and its affiliates. Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1. <br>Copyright © 2024 Merck &amp; Co., Inc., Rahway, NJ, USA and its affiliates. All rights reserved.</p>
</div>

<div class="pkgdown-footer-right">
  <p><span></span></p>
</div>

    </footer>
</div>





  </body>
</html>
